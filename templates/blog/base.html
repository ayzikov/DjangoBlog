{% load blog_tags %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Подключаем библиотеку -->
    {% load django_bootstrap5 %}

    <!-- Подключаем JS и CSS -->
    {% bootstrap_css %}
    {% bootstrap_javascript %}

    <!-- Подключаем иконки bootstrap5 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">

    <link href="{% static 'css/blog.css' %}" rel="stylesheet">


    <title>{% block title %}{% endblock %}</title>
</head>
<body>

<!-- Навигационная панель -->
<nav class="navbar navbar-expand-xl navbar-dark bg-dark fixed-top">
    <div class="container-fluid">

        <!-- Кнопка слева -->
        <a class="navbar-brand" href="{% url 'blog:post_list' %}">Мой блог</a>

        <!-- Бургер меню на маленьких экранах -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarDark" aria-controls="navbarDark" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Кнопки справа -->
        <div class="collapse navbar-collapse show" id="navbarDark">
            <ul class="navbar-nav ms-auto mb-2 mb-xl-0">
                <!-- Если пользователь авторизован -->
                {% if user.is_authenticated  %}
                    <li class="nav-item">
                        <a class="nav-link" href=" {% url 'accounts:profile' %}">

                            <!-- Проверка наличия изображения в модели profile -->
                            {% if user.profile.avatar %}
                                <img src="{{ user.profile.avatar.url }}" alt="User Image" style="height: 25px; width: 25px; border-radius: 20px">
                            {% else %}
                                <img src="/media/default.jpg" alt="User Image" style="height: 25px; width: 25px; border-radius: 20px">
                            {% endif %}

                            {% if user.first_name %}
                                {{ user.first_name }}
                            {% else %}
                                {{ user.username }}
                            {% endif %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'accounts:logout' %}">Выйти</a>
                    </li>
                <!-- Если пользователь не авторизован -->
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'accounts:login' %}">Войти</a>
                    </li>
                {% endif %}
        </div>
    </div>
</nav>

<!-- Основной контент страницы -->
<div class="container main-container">
    <!-- Делаем блок класса row чтобы можно было разместить рядом side-bar -->
    <div class="row">
        
        <!-- Вывод сообщений -->
        <div class="col-lg-8">
            {% if messages %}
                {% for message in messages %}
                    <div class="container d-flex align-items-center justify-content-center">
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show w-50  d-block" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

            {% block content %}
            {% endblock %}
        </div>

        <!-- Контент side-bar -->
        <div class="col-lg-4">

            <!-- Виджен с количеством постов -->
            <div class="card mb-4">
                  <div class="card-header">
                    This is my blog
                  </div>
                  <div class="card-body">
                        <p class="card-text">Всего написанно {% total_posts %} постов</p>
                  </div>
            </div>

            <!-- Виджет с поиском -->
            <div class="card mb-4">
                <div class="card-header">
                Поиск по постам
                </div>
                <div class="card-body">
                    <div class="container-fluid">
                        <form class="d-flex" role="search" action="{% url 'blog:post_search' %}" method="get">
                            <input class="form-control me-2" type="search" placeholder="Ваш запрос" aria-label="Search" name="query">
                            <button class="btn btn-outline-primary" type="submit">Искать</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Виджет с последними постами -->
            {% show_latest_posts 3 %}

            <!-- Виджет с самыми заккоментированными постами -->
            {% get_most_commented_posts 3 %}

            <!-- Кнопка для добавления нового поста -->
            {% if user.is_authenticated  %}
                <div class="mb-4">
                    <a class="btn btn-primary w-100" href="{% url 'blog:add_post' user.id %}">
                        Добавить пост
                    </a>
                </div>

                <div class="mb-4">
                    <a class="btn btn-primary w-100" href="{% url 'blog:my_posts_list' user.id %}">
                        Мои посты
                    </a>
                </div>
            {% endif %}

        </div>
   </div>
</div>


<footer class="py-2 bg-dark mt-2" style="position: fixed; bottom: 0; width: 100%;">
    <div class="container"><p class="m-0 text-center text-white">Copyright &copy; My Blog 2023, Powered by
        Ayzikov</p></div>
</footer>

<style>
.list-group-item-action:hover {
    background-color: rgba(208, 208, 208, 1);
}
.main-container {
    margin-top: 100px;
}
</style>

</body>
</html>